{% extends "core/base.html" %}

{% block title %}Vendors{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">

  <!-- Header -->
  <h2 class="text-2xl font-semibold mb-2">Vendors</h2>
  <p class="text-slate-400 mb-6">
    Manage vendors you send RFPs to.
  </p>

  <!-- Add Vendor Card -->
  <div class="bg-slate-900 border border-slate-800 rounded-lg p-6 mb-8">
    <h3 class="text-lg font-medium mb-4">Add Vendor</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <input
        id="vendorName"
        type="text"
        placeholder="Vendor name"
        class="bg-slate-950 border border-slate-700 rounded-md p-3 text-slate-200 focus:outline-none focus:ring-2 focus:ring-sky-500"
      />
      <input
        id="vendorEmail"
        type="email"
        placeholder="Vendor email"
        class="bg-slate-950 border border-slate-700 rounded-md p-3 text-slate-200 focus:outline-none focus:ring-2 focus:ring-sky-500"
      />
    </div>

    <button
      onclick="addVendor()"
      class="mt-4 px-4 py-2 bg-sky-500 hover:bg-sky-400 text-slate-900 font-medium rounded-md"
    >
      Add Vendor
    </button>
  </div>

  <!-- Vendor List -->
  <div class="bg-slate-900 border border-slate-800 rounded-lg p-6">
    <h3 class="text-lg font-medium mb-4">Vendor List</h3>

    <div id="vendorList" class="space-y-3 text-sm text-slate-300">
      Loading vendors...
    </div>
  </div>

</div>

<script>
  async function fetchVendors() {
    const res = await fetch("/api/vendors");
    const data = await res.json();

    const list = document.getElementById("vendorList");
    list.innerHTML = "";

    if (data.length === 0) {
      list.innerHTML = "<p class='text-slate-500'>No vendors added yet.</p>";
      return;
    }

    data.forEach(v => {
      const div = document.createElement("div");
      div.className =
        "flex items-center justify-between bg-slate-950 border border-slate-800 rounded-md p-3";

      div.innerHTML = `
        <span>${v.name} <span class="text-slate-500">(${v.email})</span></span>
      `;

      list.appendChild(div);
    });
  }

  async function addVendor() {
    const name = document.getElementById("vendorName").value;
    const email = document.getElementById("vendorEmail").value;

    if (!name || !email) {
      alert("Please enter vendor name and email.");
      return;
    }

    await fetch("/api/vendors/create", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ name, email }),
    });

    document.getElementById("vendorName").value = "";
    document.getElementById("vendorEmail").value = "";

    fetchVendors();
  }

  fetchVendors();
</script>
{% endblock %}
